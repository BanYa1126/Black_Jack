<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2c3e50;
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        h1 {
            position: absolute;
            top: 10px;
            text-align: center;
            margin: 0;
            width: 100%;
        }

        #dealer {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            top: 60px;
        }

        #player {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            bottom: 100px;
        }

        #player h2 {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .card {
            width: 100px;
            height: 140px;
            margin: 5px;
        }

        button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <h1>Blackjack Game</h1>
    
    <div id="dealer">
        <h2>Dealer</h2>
        <div id="dealer-cards"></div>
    </div>

    <div id="player">
        <h2>Player - $<span id="player-money"></span></h2>
        <div id="player-cards"></div>
    </div>

    <div id="controls">
        <button id="hit-btn" onclick="hit()">Hit</button>
        <button id="stay-btn" onclick="stay()">Stay</button>
        <button id="double-btn" onclick="doubleDown()">Double Down</button>
        <button id="surrender-btn" onclick="surrender()">Surrender</button>
    </div>

    <script>
        const cardBack = "cards/Back_Side.png";
        let dealerCards = [];
        let playerCards = [];
        let playerMoney = Math.floor(Math.random() * 9000) + 1000;
        let betAmount = 100;
        let decks = [];

        // 카드 덱 생성: 4 ~ 8 덱 중 하나 선택하여 생성
        function createDecks() {
            const suits = ['hearts', 'diamonds', 'clubs', 'spades'];
            const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            const numberOfDecks = Math.floor(Math.random() * 5) + 4;
            decks = [];

            for (let i = 0; i < numberOfDecks; i++) {
                for (let suit of suits) {
                    for (let value of values) {
                        decks.push({ value, suit, img: `cards/${value}_of_${suit}.png` });
                    }
                }
            }

            shuffleDecks();
        }

        // 카드 덱 섞기
        function shuffleDecks() {
            for (let i = decks.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [decks[i], decks[j]] = [decks[j], decks[i]];
            }
        }

        // 게임 시작 시 카드 나누기
        function dealCards() {
            dealerCards = [];
            playerCards = [];
            dealerCards.push(decks.pop());
            dealerCards.push(decks.pop());
            document.getElementById("dealer-cards").innerHTML = `
                <img class="card" src="${dealerCards[0].img}" alt="dealer card">
                <img class="card" src="${cardBack}" alt="dealer card back">
            `;

            playerCards.push(decks.pop());
            playerCards.push(decks.pop());
            updatePlayerCards();
            updatePlayerMoney();
            checkForBlackjack();
        }

        // 플레이어 카드 화면에 표시
        function updatePlayerCards() {
            const playerCardsDiv = document.getElementById("player-cards");
            playerCardsDiv.innerHTML = "";
            playerCards.forEach(card => {
                playerCardsDiv.innerHTML += `<img class="card" src="${card.img}" alt="player card">`;
            });
        }

        function updateDealerCards() {
            const dealerCardsDiv = document.getElementById("dealer-cards");
            dealerCardsDiv.innerHTML = "";
            dealerCards.forEach(card => {
                dealerCardsDiv.innerHTML += `<img class="card" src="${card.img}" alt="dealer card">`;
            });
        }

        function updatePlayerMoney() {
            document.getElementById('player-money').textContent = playerMoney;
        }

        // Hit 버튼: 카드를 한 장 받는 로직
        function hit() {
            playerCards.push(decks.pop());
            updatePlayerCards();

            if (calculateHandValue(playerCards) >= 21) {
                stay();
            }
        }

        // Stay 버튼: 딜러의 로직 시작
        function stay() {
            revealDealerCard();
            setTimeout(dealerTurn, 1000);
        }

        // Double Down 버튼
        function doubleDown() {
            betAmount *= 2;
            playerCards.push(decks.pop());
            updatePlayerCards();
            setTimeout(dealerTurn, 1000);
        }

        // Surrender 버튼
        function surrender() {
            playerMoney += betAmount / 2;
            alert('Surrender! 베팅 금액의 절반을 돌려받습니다.');
            updatePlayerMoney();
            dealCards();
        }

        // 딜러의 두 번째 카드 공개
        function revealDealerCard() {
            updateDealerCards();
        }

        // 딜러의 규칙에 따른 카드 받기
        function dealerTurn() {
            let dealerValue = calculateHandValue(dealerCards);

            function drawDealerCard() {
                if (dealerValue < 17) {
                    dealerCards.push(decks.pop());
                    updateDealerCards();
                    dealerValue = calculateHandValue(dealerCards);
                    setTimeout(drawDealerCard, 1000); // 다음 카드를 받을 때까지 1초 딜레이
                } else {
                    determineWinner();
                }
            }

            drawDealerCard();
        }

        // 손 패의 총합 계산
        function calculateHandValue(cards) {
            let value = 0;
            let aceCount = 0;

            cards.forEach(card => {
                if (card.value === 'A') {
                    aceCount++;
                    value += 11;
                } else if (['J', 'Q', 'K'].includes(card.value)) {
                    value += 10;
                } else {
                    value += parseInt(card.value);
                }
            });

            while (value > 21 && aceCount > 0) {
                value -= 10;
                aceCount--;
            }

            return value;
        }

        // 블랙잭 체크
        function checkForBlackjack() {
            const playerValue = calculateHandValue(playerCards);
            const dealerValue = calculateHandValue(dealerCards);

            if (playerValue === 21 && dealerValue === 21) {
                revealDealerCard();
                alert("Both have blackjack! It's a tie.");
                dealCards();
            } else if (playerValue === 21) {
                alert("Player has blackjack! Player wins!");
                playerMoney += betAmount * 1.5;
                updatePlayerMoney();
                dealCards();
            } else if (dealerValue === 21) {
                revealDealerCard();
                alert("Dealer has blackjack! Dealer wins.");
                playerMoney -= betAmount;
                updatePlayerMoney();
                dealCards();
            }
        }

        // 승패 결정 및 결과 팝업
        function determineWinner() {
            const playerValue = calculateHandValue(playerCards);
            const dealerValue = calculateHandValue(dealerCards);
            let resultMessage = '';

            if (playerValue > 21) {
                playerMoney -= betAmount;
                resultMessage = 'Player busts! Dealer wins.';
            } else if (dealerValue > 21) {
                playerMoney += betAmount;
                resultMessage = 'Dealer busts! Player wins.';
            } else if (playerValue > dealerValue) {
                playerMoney += betAmount;
                resultMessage = 'Player wins!';
            } else if (playerValue < dealerValue) {
                playerMoney -= betAmount;
                resultMessage = 'Dealer wins!';
            } else {
                resultMessage = "It's a tie!";
            }

            updatePlayerMoney();
            alert(resultMessage);
            dealCards();
        }

        // 페이지 로드 시 게임 시작
        window.onload = function() {
            createDecks();
            dealCards();
        }
    </script>
</body>
</html>